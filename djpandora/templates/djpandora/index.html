{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block extrahead %}
<script type="text/javascript">

    function ajax_vote(song_id, value){
        url = '{% url djpandora_vote %}?song_id=' + song_id + '&vote=' + value
        $.getJSON(url, function(data){
            if(data['status'] == 'success'){
                if(value == 'like'){
                    link = '<a href="#" onclick="javascript:return ajax_vote(' + song_id + ', \'dislike\');">Dislike</a>';
                    $('#voting').html(link);
                    votes = parseInt($('#vote-count').text());
                    $('#vote-count').text(votes + 1);
                }
                else{
                    link = '<a href="#" onclick="javascript:return ajax_vote(' + song_id + ', \'like\');">Like</a>';
                    $('#voting').html(link);
                    votes = parseInt($('#vote-count').text());
                    $('#vote-count').text(votes - 1);
                }
            }
        });
    }

    function update_progress(){
        progress += 1;
        value = progress / length * 100;
        $('#time-left').progressbar("option", "value", value);
    }

    function update_playing(){
        url = '{% url djpandora_status %}'
        $.getJSON(url, function(data){
            if (data['title'] == 'null'){
                $('#song-loading').show();
                $('#song-information').hide();
            }
            else {
                $('#song-loading').hide();
                $('#song-information').show();
                $('#song-name').text('Song: ' + data['title']);
                $('#artist-name').text('Artist: ' + data['artist']);
                $('#vote-total').html('Votes: <span id="vote-count">' + data['votes'] + '</span>');
                $('#station').text('Station: ' + data['station']);
                $('#playlist').html(data['upcoming']);
                $('#voting').html(data['vote-html']);
                $('#time-left').progressbar( "option", "value", data['time']);
                progress = data['progress'];
                length = data['length'];
            }
        });
    }

    function station_check(){
        url = '{% url djpandora_stations %}'
        $.getJSON(url, function(data){
            $('#stations').html(data); 
        });

    }

    function station_vote(){
        return false;
    }

    $(document).ready(function(){
        var progress = 0;
        var length = 0;
        $( "#accordion" ).accordion();
        $('#time-left').progressbar({value: 0});
        $('song-information').hide();
        update_playing();
        station_check();
        setInterval('update_playing()', 15000);
        setInterval('station_check()', 30000);
        setInterval('update_progress()', 1500);
    });

</script>
{% endblock %}
{% block content %}
	<h1>Welcome to DjPandora</h1>

    <div id="accordion">
        <h3><a href="#">Song Information</a></h3>
            <div>
                <p id="song-loading">Loading...</p>
                <ul id="song-information">
                    <li id='station'></li>
                    <li id='song-name'></li>
                    <li id='artist-name'></li>
                    <li id='vote-total'></li>
                    <li id='voting'></li>
                    <li id='time-left'></li>
                </ul>
            </div>
        <h3><a href="#">Upcoming Songs</a></h3>
            <div id='playlist'></div>
        <h3><a href="#">Stations</a></h3>
            <div id='stations'></div>
    </div>
{% endblock %}